var Ne=Object.defineProperty;var Te=(r,u,f)=>u in r?Ne(r,u,{enumerable:!0,configurable:!0,writable:!0,value:f}):r[u]=f;var Ce=(r,u,f)=>(Te(r,typeof u!="symbol"?u+"":u,f),f),le=(r,u,f)=>{if(!u.has(r))throw TypeError("Cannot "+f)};var n=(r,u,f)=>(le(r,u,"read from private field"),f?f.call(r):u.get(r)),l=(r,u,f)=>{if(u.has(r))throw TypeError("Cannot add the same private member more than once");u instanceof WeakSet?u.add(r):u.set(r,f)},h=(r,u,f,g)=>(le(r,u,"write to private field"),g?g.call(r,f):u.set(r,f),f);var v=(r,u,f)=>(le(r,u,"access private method"),f);(function(r,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(r=typeof globalThis<"u"?globalThis:r||self,r.com=u())})(this,function(){var ee,I,R,F,D,J,j,X,q,P,H,m,z,B,ue,U,N,$,y,M,T,S,O,G,x,Q,W,a,A,K,te,Oe,ne,Ee,ie,Se,Y,he;"use strict";function r(t,e,s,o){if(r.null==e)throw new Error(`${s} is null and not a valid ${t}.`);if(r.invalid==e)throw new Error(`${s} is ${typeof o} and not a valid ${t}.`)}r.array="array",r.function="function",r.object="object",r.string="string",r.null=0,r.invalid=1;function u(t,e){e==null&&r(r.array,r.null,t,e),(typeof e!="object"||!Array.isArray(e))&&r(r.array,r.invalid,t,e)}function f(t,e){e==null&&r(r.function,r.null,t,e),typeof e!="function"&&r(r.function,r.invalid,t,e)}function g(t,e){e==null&&r(r.object,r.null,t,e),(typeof e!="object"||Array.isArray(e))&&r(r.object,r.invalid,t,e)}function Z(t,e){e==null&&r(r.string,r.null,t,e),typeof e!="string"&&!(e instanceof String)&&r(r.string,r.invalid,t,e)}function L(t){return typeof t=="object"&&t!=null&&Array.isArray(t)}function ve(t){return typeof t=="function"&&t!=null}function V(t){return typeof t=="object"&&t!=null&&!Array.isArray(t)}function ce(t){return(typeof t=="string"||t instanceof String)&&t!=null}const fe=[],ae="_xso_com_",w={COMPONENTS:fe,COMPONENTS_PREFIX:ae,getComponent:t=>{const e=fe.find(s=>s.key==t);return e?e.instance:null},isKey:t=>t.indexOf(ae)==0};class se{constructor(e,s){l(this,ee,null);l(this,I,null);l(this,R,null);l(this,F,null);h(this,ee,e),h(this,I,s)}get current(){return n(this,F)}set current(e){h(this,F,e),n(this,I).fire(this)}set(e){return h(this,R,e),this}get(){return n(this,R)}}ee=new WeakMap,I=new WeakMap,R=new WeakMap,F=new WeakMap,se.prototype.toString=function(){return this.current};function be(t,e,s){g("Properties",e);for(const o of Object.keys(e)){const i=e[o];if(o=="_"&&i)L(i)?b(t,i,s):V(i)?b(t,[i],s):t.textContent=i;else if(o=="$"&&i)L(i)?b(t,i,s,!0):V(i)?b(t,[i],s,!0):t.innerHTML=i;else if(o=="text"&&i)Z(o,i),t.innerText=i;else if(o=="html"&&i)Z(o,i),t.innerHTML=i;else if(o=="style"&&i){g(o,i);for(const c of Object.keys(i))c.indexOf("--")===0?t.style.setProperty(c,i[c]):t.style[c]=i[c]}else if(o=="className"&&i)Z(o,i),t.className=i;else if(o=="classList"&&i)pe(t,i);else if(o=="class"&&i){if(ce(i))t.className=i;else if(L(i))pe(t,i);else if(i!=null&&i!=null)throw new Error(`CSS Class of type ${typeof i} is not valid, only string or array of strings is accepted.`)}else o.indexOf("on")==0?i&&(f(o,i),t.addEventListener(o.substring(2).toLowerCase(),i)):i!=null&&i!=null&&t.setAttribute(o,i)}}function pe(t,e){u(key,e);for(const s of e)Z(s),t.classList.add(s)}function b(t,e,s,o){const i=[];if(V(e))if(e instanceof se){const c=b(t,e.get(),s);if(c.length==0)throw new Error("Reference is empty with no valid elements.");if(c.length>1)throw new Error("Reference with more than 1 element.");e.current=c[0]}else{const c=Object.keys(e);if(c.length>1)throw new Error(`Object with more than 1 keys: ${c.join(", ")}`);if(c.length==0)throw new Error("Object with no key, but one is required.");for(const p of c){const E=e[p];if(w.isKey(p)){let d=w.getComponent(p);if(d)d=d.clone(),d.parent=t,d.render(E),s&&s.appendChildComponent(d),i.push(d);else{const we=document.createElement("xso-com-error");we.innerText="# XSO Component Error #",t.appendChild(we)}}else{const d=document.createElement(p);be(d,E,s),i.push(d),t.appendChild(d)}}}else if(L(e))for(const c of e)if(ce(c))if(o){const p=document.createElement("span");p.innerHTML=c,t.appendChild(p),i.push(c)}else{const p=document.createTextNode(c);t.appendChild(p),i.push(c)}else b(t,c,s);else throw new Error(`View of type ${typeof e} is invalid, only object or array of objects.`);return i}class de{constructor(e,s){l(this,D,null);l(this,J,null);l(this,j,null);l(this,X,null);h(this,D,e),h(this,j,s)}set val(e){JSON.stringify(n(this,X))!=JSON.stringify(e)&&(h(this,J,n(this,j)),h(this,j,e),h(this,X,JSON.stringify(e)),console.log("Props >> "+n(this,D).key(),e))}get val(){return n(this,j)}get previous(){return n(this,J)}}D=new WeakMap,J=new WeakMap,j=new WeakMap,X=new WeakMap,de.prototype.toString=function(){return this.val};class me{constructor(e,s,o){l(this,B);l(this,q,null);l(this,P,null);l(this,H,null);l(this,m,null);l(this,z,0);h(this,q,e),h(this,P,s),h(this,m,o)}set $val(e){n(this,m)!==e&&(v(this,B,ue).call(this,e),n(this,q).render(),n(this,P).fire(this))}get $val(){return n(this,m)}set val(e){n(this,m)!==e&&(v(this,B,ue).call(this,e),n(this,P).fire(this))}get val(){return n(this,m)}get previous(){return n(this,H)}get lastChanged(){return n(this,z)}}q=new WeakMap,P=new WeakMap,H=new WeakMap,m=new WeakMap,z=new WeakMap,B=new WeakSet,ue=function(e){h(this,H,n(this,m)),h(this,m,e),h(this,z,Date.now())},me.prototype.toString=function(){return this.val};class ke{constructor(){l(this,U,[]);l(this,N,[])}add(e,s){n(this,U).push({items:e,func:s})}fire(e){const s=n(this,U).filter(o=>o.items.includes(e));for(const o of s)o&&!n(this,N).includes(o.func)&&(n(this,N).push(o.func),setTimeout(()=>{n(this,N).splice(n(this,N).indexOf(o.func),1),o.func()},0))}}U=new WeakMap,N=new WeakMap;function ye(t){return t instanceof C}function re(t){if(!ye(t))throw new Error("Invalid component, because not implement the component class.")}const oe=class oe{constructor(e,s){l(this,te);l(this,ne);l(this,ie);l(this,Y);l(this,$,!1);l(this,y,null);l(this,M,null);l(this,T,null);l(this,S,null);l(this,O,null);l(this,G,[]);l(this,x,()=>{});l(this,Q,()=>{});l(this,W,()=>{});l(this,a,{elements:[],components:[]});l(this,A,new ke);Ce(this,"parent",null);l(this,K,null);if(!ve(e)||e.toString().indexOf("function")!=0)throw new Error("Only classic functions are used for components and arrow function is not supported.");h(this,y,e),h(this,M,s),v(this,te,Oe).call(this)}name(){return n(this,y).name}clone(){return new oe(n(this,y),n(this,M))}logErrorStack(){window.setTimeout(()=>console.error(this.name()+" >> Component"+n(this,M)),0)}childrenElements(){return[...n(this,a).elements]}childrenComponents(){return[...n(this,a).components]}appendChildComponent(e){re(e),n(this,a).components.push(e)}mount(e){e?h(this,x,e):n(this,x).call(this)}unmount(e){e?h(this,Q,e):(v(this,ie,Se).call(this),v(this,ne,Ee).call(this),n(this,Q).call(this))}view(e){h(this,W,e)}ref(){return new se(this,n(this,A))}changes(e,s){n(this,A).add(e,s)}render(e){var s;try{const o=this;n(this,S)?(n(this,K)&&clearTimeout(n(this,K)),h(this,K,setTimeout(()=>{var i;v(i=o,Y,he).call(i,e)},0))):v(s=o,Y,he).call(s,e)}catch(o){throw this.logErrorStack(),o}}static isSameKind(e,s){let o=null;for(const c of Object.keys(e))o=c;const i=w.getComponent(o);return n(i,y)===n(s,y)}function(){return n(this,y)}key(){return n(this,T)}destroy(){const e=w.COMPONENTS.findIndex(s=>s.key==n(this,T));w.COMPONENTS.splice(e,1)}state(e){if(n(this,O))return n(this,G)[n(this,O).state++];const s=new me(this,n(this,A),e);return n(this,G).push(s),s}};$=new WeakMap,y=new WeakMap,M=new WeakMap,T=new WeakMap,S=new WeakMap,O=new WeakMap,G=new WeakMap,x=new WeakMap,Q=new WeakMap,W=new WeakMap,a=new WeakMap,A=new WeakMap,K=new WeakMap,te=new WeakSet,Oe=function(){for(;;){const e=w.COMPONENTS_PREFIX+"["+this.name()+"]_"+(Math.random()+1).toString(36).substring(2);if(!w.COMPONENTS.find(s=>s.key==e)){h(this,T,e);break}}w.COMPONENTS.push({key:n(this,T),instance:this})},ne=new WeakSet,Ee=function(){if(n(this,a).elements.length>0){if(parent=n(this,a).elements[0].parentNode,parent==null)return;for(const e of n(this,a).elements)parent.contains(e)&&parent.removeChild(e)}},ie=new WeakSet,Se=function(){for(const e of n(this,a).components)e.unmount();n(this,a).components=[]},Y=new WeakSet,he=function(e){n(this,S)?e?n(this,S).val=e:h(this,O,{state:0}):h(this,S,new de(this,e)),n(this,$)==!1&&n(this,y).bind(this)(n(this,S).val);let s=n(this,W).bind(this)();(!s||s.length==0)&&(s=[{span:{style:{display:"none"}}}]);let o=null;n(this,O)&&(o=n(this,a).elements[0].parentNode);const i=document.createDocumentFragment(),c=n(this,a).components;if(n(this,a).components=[],b(i,s,this),n(this,O)){const p=[];for(const E of i.children)p.push(E);if(n(this,a).elements.length==0)this.parent.appendChild(i);else{o.insertBefore(i,n(this,a).elements[0]);for(const E of c)E.unmount();for(const E of n(this,a).elements)o.contains(E)&&o.removeChild(E)}n(this,a).elements=p}else{for(const p of i.children)n(this,a).elements.push(p);this.parent.appendChild(i)}h(this,O,null),n(this,$)==!1&&(h(this,$,!0),n(this,x)&&window.setTimeout(n(this,x),0))};let C=oe;C.prototype.toString=function(){return this.key()},C.prototype.isSameKind=function(t,e){return C.isSameKind(t,e)};function je(t){g("Component Props",t);let e=null;for(const s of Object.keys(t)){if(e!=null)throw new Error(`More than 1 component in the same object: ${t}`);e=t[s],g("Component Props Loaded",e)}return e}function ge(t){g("jsonDefinition of an invalid object.",t);let e=null;for(const o of Object.keys(t))e=o;let s=e;return e.indexOf(w.COMPONENTS_PREFIX)==0&&(s=e.substring(e.indexOf("[")+1,e.lastIndexOf("]"))),JSON.stringify({[s]:t[e]})}function _(t,e){const s=o=>new Error(`Only ${e.function().name} type is accepted! This component is invalid: ${ge(o)}`);if(L(t)){for(const o of t)if(g("ensureSameKind of an invalid object.",o),!C.isSameKind(o,e))throw s(o)}else if(V(t)){if(!C.isSameKind(t,e))throw s(t)}else throw new Error("Invalid kind.")}_.required=(t,e)=>{if(t)return _(t,e);throw new Error(`${e.name()} is required.`)},_.optional=(t,e)=>{t&&_(t,e)};function k(t){return f("Component",t),new C(t,new Error().stack)}return k.create=(t,e,s)=>{re(e),e.parent=t,e.render(s)},k.ensure=re,k.is=ye,k.ensureType=_,k.props=je,k.json=ge,k});
